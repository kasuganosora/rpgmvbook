# 第一章：什么是游戏引擎？

## 一个简单的比喻

想象你要盖一座房子。

**没有工具的情况**：
- 你需要自己造锤子、锯子
- 你需要自己设计门窗的样式
- 你需要自己研究怎么让房子不倒塌
- 每盖一座房子，都要从头来一遍

**有工具的情况**：
- 你有现成的锤子、锯子
- 有标准的门窗可以买
- 有成熟的建筑方案可以参考
- 只需要决定"我要什么样的房子"，然后组装

**游戏引擎就是那一整套"建筑工具"**。

---

## 游戏 vs 游戏引擎

### 游戏

游戏是**最终产品**，玩家直接玩的东西。

比如《最终幻想7》、《宝可梦》、《原神》——这些都是游戏。

### 游戏引擎

游戏引擎是**制作游戏的工具**，开发者用它来造游戏。

比如 Unity、Unreal Engine、Godot——这些都是引擎。

### 它们的关系

```
游戏引擎 + 游戏内容（美术/音乐/剧情/关卡设计） = 完整的游戏

┌─────────────────────────────────────────────────┐
│                   完整的游戏                     │
│  ┌───────────────┐  ┌───────────────────────┐  │
│  │   游戏引擎    │  │      游戏内容          │  │
│  │               │  │                       │  │
│  │ • 渲染画面    │  │ • 角色立绘            │  │
│  │ • 播放声音    │  │ • 背景音乐            │  │
│  │ • 处理输入    │  │ • 剧情脚本            │  │
│  │ • 碰撞检测    │  │ • 地图数据            │  │
│  │ • 存档读档    │  │ • 物品列表            │  │
│  │ • ...         │  │ • ...                 │  │
│  └───────────────┘  └───────────────────────┘  │
└─────────────────────────────────────────────────┘
```

**打个比方**：
- 游戏引擎 = 汽车的底盘、发动机、轮胎
- 游戏内容 = 车身颜色、座椅材质、车载音乐
- 完整游戏 = 组装好的一辆汽车

---

## 为什么需要游戏引擎？

### 问题一：没有引擎，怎么开发游戏？

假设你要做一个最简单的 RPG：
1. 画一个角色在屏幕上
2. 按键盘让角色移动
3. 角色遇到墙壁不能穿过

**没有引擎，你需要从零实现**：

```javascript
// 1. 创建画布
var canvas = document.createElement('canvas');
document.body.appendChild(canvas);

// 2. 获取绑定上下文（用于绑定）
var ctx = canvas.getContext('2d');

// 3. 加载图片
var playerImage = new Image();
playerImage.src = 'player.png';

// 4. 监听键盘事件
var keys = {};
document.addEventListener('keydown', function(e) {
    keys[e.key] = true;
});
document.addEventListener('keyup', function(e) {
    keys[e.key] = false;
});

// 5. 游戏循环
var playerX = 100, playerY = 100;
function gameLoop() {
    // 清屏
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 更新位置
    if (keys['ArrowUp']) playerY -= 3;
    if (keys['ArrowDown']) playerY += 3;
    if (keys['ArrowLeft']) playerX -= 3;
    if (keys['ArrowRight']) playerX += 3;

    // 边界检测
    if (playerX < 0) playerX = 0;
    if (playerX > canvas.width - 32) playerX = canvas.width - 32;

    // 绘制
    ctx.drawImage(playerImage, playerX, playerY);

    // 下一帧
    requestAnimationFrame(gameLoop);
}

playerImage.onload = gameLoop;
```

这只是一个角色移动，就已经要写这么多代码了。

**如果加上更多功能**：
- 地图系统？几百行
- 碰撞检测？几十行
- NPC 对话？上百行
- 战斗系统？几百行
- 存档系统？上百行
- ...

**一个完整的 RPG，可能需要几万行代码**。

### 问题二：有了引擎，怎么开发游戏？

**使用引擎，你只需要关注"游戏内容"**：

```javascript
// 使用引擎后的代码（假设）

// 创建玩家
var player = new Engine.Sprite({
    image: 'player.png',
    x: 100,
    y: 100,
    speed: 3
});

// 添加到场景
Engine.scene.add(player);

// 设置碰撞
player.setCollision('boundary');

// 引擎自动处理渲染、输入、碰撞
Engine.start();
```

**引擎帮你做了什么？**
- 渲染循环（自动每帧绘制）
- 输入处理（自动检测键盘）
- 碰撞检测（自动处理边界）
- 资源管理（自动加载图片）

---

## RPG 游戏引擎的核心需求

不同类型的游戏，需要不同的引擎功能。

### RPG 游戏的特点

| 特点 | 引擎需求 |
|------|----------|
| 大地图探索 | 瓦片地图系统、地图切换 |
| 角色移动 | 键盘输入、碰撞检测 |
| NPC 交互 | 事件系统、对话系统 |
| 战斗系统 | 回合制逻辑、伤害计算 |
| 角色成长 | 数据系统、存档系统 |
| 丰富剧情 | 脚本系统、变量系统 |

### RPG 引擎的核心模块

```
┌─────────────────────────────────────────┐
│            RPG 游戏引擎                  │
├─────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────────┐  │
│  │  渲染模块   │  │    输入模块     │  │
│  │             │  │                 │  │
│  │ • 画布管理  │  │ • 键盘检测      │  │
│  │ • 精灵渲染  │  │ • 鼠标/触摸     │  │
│  │ • 地图渲染  │  │ • 手柄支持      │  │
│  │ • 动画播放  │  │                 │  │
│  └─────────────┘  └─────────────────┘  │
│                                         │
│  ┌─────────────┐  ┌─────────────────┐  │
│  │  场景模块   │  │    数据模块     │  │
│  │             │  │                 │  │
│  │ • 地图管理  │  │ • 角色属性      │  │
│  │ • 场景切换  │  │ • 物品列表      │  │
│  │ • 对象管理  │  │ • 游戏变量      │  │
│  │             │  │ • 存档读档      │  │
│  └─────────────┘  └─────────────────┘  │
│                                         │
│  ┌─────────────┐  ┌─────────────────┐  │
│  │  事件模块   │  │    UI 模块      │  │
│  │             │  │                 │  │
│  │ • 触发器    │  │ • 窗口系统      │  │
│  │ • 条件判断  │  │ • 对话框        │  │
│  │ • 指令执行  │  │ • 菜单界面      │  │
│  └─────────────┘  └────────────────-┘  │
│                                         │
│  ┌────────────────────────────────────┐│
│  │            音频模块                ││
│  │  • BGM 背景音乐  • SE 音效         ││
│  └────────────────────────────────────┘│
└─────────────────────────────────────────┘
```

---

## RPG Maker MV 的架构

我们要学习的对象——RPG Maker MV，它的架构是这样的：

```
┌──────────────────────────────────────────────────┐
│                   游戏内容                        │
│  (地图数据、角色数据、技能配置、事件脚本...)       │
├──────────────────────────────────────────────────┤
│                   rpg_objects.js                 │
│  Game_Temp, Game_System, Game_Switches,          │
│  Game_Variables, Game_SelfSwitches, Game_Screen, │
│  Game_Picture, Game_Map, Game_Player...          │
├──────────────────────────────────────────────────┤
│                   rpg_managers.js                │
│  DataManager, ConfigManager, StorageManager,     │
│  SceneManager, BattleManager, PluginManager...   │
├──────────────────────────────────────────────────┤
│                   rpg_scenes.js                  │
│  Scene_Base, Scene_Boot, Scene_Map,              │
│  Scene_Battle, Scene_Menu, Scene_Item...         │
├──────────────────────────────────────────────────┤
│                   rpg_sprites.js                 │
│  Sprite_Base, Sprite_Character, Sprite_Battler,  │
│  Spriteset_Map, Spriteset_Battle...              │
├──────────────────────────────────────────────────┤
│                   rpg_windows.js                 │
│  Window_Base, Window_Selectable, Window_Command, │
│  Window_MenuCommand, Window_BattleLog...         │
├──────────────────────────────────────────────────┤
│                   rpg_core.js                    │
│  Bitmap, Sprite, Window, Tilemap, Audio, Input,  │
│  TouchInput, Graphics, Utils...                  │
├──────────────────────────────────────────────────┤
│                   PIXI.js                        │
│  (WebGL/Canvas 渲染库)                           │
└──────────────────────────────────────────────────┘
```

**从下往上看**：
1. **PIXI.js**：底层渲染（画图、处理 GPU）
2. **rpg_core.js**：核心功能（位图、精灵、输入、音频）
3. **rpg_windows.js**：UI 系统（窗口、菜单）
4. **rpg_sprites.js**：视觉表现（角色精灵、地图精灵集）
5. **rpg_scenes.js**：场景逻辑（地图场景、战斗场景）
6. **rpg_managers.js**：管理器（数据、场景、战斗）
7. **rpg_objects.js**：游戏对象（玩家、地图、事件）
8. **游戏内容**：数据文件（JSON）、资源文件（图片、音频）

---

## 我们要做什么？

在这个栏目中，我们将**简化但完整地实现一个 RPG 引擎**。

### 我们会实现的模块

| 模块 | 功能 | 复杂度 |
|------|------|--------|
| 游戏循环 | 60 FPS 主循环 | ★ |
| 渲染系统 | Canvas 2D 渲染 | ★★ |
| 瓦片地图 | 2D 地图渲染 | ★★★ |
| 精灵系统 | 角色、NPC 渲染 | ★★ |
| 输入系统 | 键盘控制 | ★ |
| 碰撞检测 | 矩形碰撞 | ★★ |
| 事件系统 | 触发器、对话 | ★★★ |
| UI 系统 | 窗口、菜单 | ★★★ |
| 数据系统 | 角色属性、物品 | ★★ |
| 存档系统 | 本地存储 | ★★ |

### 我们不会实现的（太复杂）

- WebGL 渲染（用 Canvas 2D 足够学习）
- 复杂的战斗系统（实现简单回合制）
- 多语言支持
- 网络功能
- 高级物理

---

## 本章小结

1. **游戏引擎**是制作游戏的工具，不是游戏本身
2. **引擎提供通用功能**，让开发者专注游戏内容
3. **RPG 引擎**需要地图、角色、事件、战斗、存档等模块
4. **我们将参考 RPG Maker MV**，实现一个简化版引擎

## 下一章

[第二章：游戏主循环](./02-game-loop.md) - 理解游戏是如何"动"起来的
